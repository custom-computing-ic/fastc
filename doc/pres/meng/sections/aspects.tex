\section{Aspect Descriptions}
\begin{frame}
  \frametitle{3. Aspect Descriptions}
  \begin{enumerate}
    \setlength{\itemsep}{15pt}
  \item \textbf{System Aspect Descriptions}
    \begin{itemize}
    \item FAST + C application
    \end{itemize}
  \item \textbf{Implementation Aspect Descriptions}
    \begin{itemize}
    \item FPGA and dataflow specific optimisations
    \end{itemize}
  \item \textbf{Exploration Aspect Descriptions}
    \begin{itemize}
    \item user guided design space exploration strategies
    \end{itemize}
  \item \textbf{Development Aspect Descriptions}
    \begin{itemize}
    \item automate repetitive, error-prone development tasks
    \end{itemize}
  \end{enumerate}
\end{frame}

\begin{frame}{System Aspects: Run-time Reconfiguration}
  \begin{itemize}
  \item idle functions may appear in large designs
  \item use run-time reconfiguration to remove idle functions
    \begin{columns}
      \begin{column}{.55\textwidth}
  \begin{figure}[!ht]
    \centering
    \def\svgwidth{\linewidth}
    \input{figs/rtm-desc.pdf_tex}
  \end{figure}
      \end{column}
      \begin{column}{.45\textwidth}
  \begin{figure}[!ht]
    \centering
    \def\svgwidth{\linewidth}
    \input{figs/rtm-idle.pdf_tex}
  \end{figure}
      \end{column}
    \end{columns}


  \end{itemize}
\end{frame}

\begin{frame}[fragile]{System Aspects: Run-time Reconfiguration}
  \begin{itemize}
    \setlength{\itemsep}{8pt}
  \item pragmas specify configuration parameters
\end{itemize}
    \begin{columns}
      \begin{column}{.7\textwidth}
        \begin{center}
          \begin{lstlisting}[style=MaxC]
#pragma fast hw:f1 cfg:c0(Par=2)
x = f(0);
#pragma fast hw:f1 cfg:c1(Par=1)
y = f(x);
#pragma fast hw:g1 cfg:c1(Par=1)
z = g(x, y);
          \end{lstlisting}
        \end{center}
      \end{column}
      \begin{column}{.3\textwidth}
        {\footnotesize
          \begin{table}[!h]
            \renewcommand{\arraystretch}{1.3}
            \hspace{-2cm}
            \begin{tabular}{c|c|c}
              \multicolumn{3}{c}{\bf{partition}} \\
              \hline
              \bf{call.key} & \bf{hw} & \bf{cfg}  \\
              \hline
              main:f:1 & fast\_f0 & c0 \\
              main:f:2 & fast\_f1 & c1 \\
              main:g:3 & fast\_g & c1 \\
            \end{tabular}
          \end{table}
        }
      \end{column}
    \end{columns}

\end{frame}

\begin{frame}[fragile]{3. Aspect Descriptions}
  \frametitle{ System Aspects: Run-time Reconfiguration}
  Map function calls (on the CPU side) to configurations:
  \begin{itemize}
  \item inspect each function call
  \item if part of a partition, add corresponding FAST pragma
  \item $ \text{partition} : \text{funcCall} \rightarrow (\text{kernel}, \text{config}) $
  \end{itemize}

  \begin{lstlisting}[style=lara]
aspectdef AspReconfig
  input: partition
  function.call:
    if (call.key in partition) {
     p = partition[call.key]
     config = p.cfg + '(Par = ' + p.par + ')'
     kernel = p.par
     call.prepend('#pragma fast hw:'kernel' cfg:'config)
    }
end
  \end{lstlisting}
\end{frame}


\begin{frame}[fragile]{3. Aspect Descriptions}
  \frametitle{Implementation Aspects: Operator Optimisation}
  Map computation to Digital Signal Processors:
  \begin{itemize}
  \item $ \text{opMapping} : \overrightarrow{\text{opOccurence}} \rightarrow \text{factor}$
  \item $\text{factor} \in \{\text{none}, \text{balanced}, \text{full}\} $
  \item mapping can be varied by different aspect to support design
    space exploration
  \end{itemize}
  \begin{lstlisting}[label=lst:label, style=lara]
aspectdef DspBalancing
input: opMapping
 function.stmt:
   opUsage = countOperatorUsage(stmt)
   factor  = opMapping[opUsage]
   if (factor != '')
     stmt.prepend('#pragma fast balanceDSP:' + factor);
end
  \end{lstlisting}
\end{frame}

\begin{frame}{3. Implementation Aspects: Operator Optimisation}
  \begin{figure}[!ht]
    \centering
    \def\svgwidth{\linewidth}
    \input{figs/opt-split.pdf_tex}
  \end{figure}

\end{frame}

\begin{frame}[fragile]{3. Aspect Descriptions}
  \frametitle{Exploration Aspect Descriptions: Iterative Exploration}
  Automate design space exploration
  \begin{itemize}
  \item vary an attribute of a dataflow configuration
  \item generate FAST configuration and compile FPGA bitstream
  \item extract feedback from compilation report
  \item stop when a resource usage limit is reached
  \end{itemize}
  \begin{lstlisting}[label=lst:label, style=lara]
aspectdef DesignExploration
input: attribute, start, step, res, res_limit, config
  config[attribute] = start
  do {
    var designName = genName(config)
    generateFASTDesign(designName, config)
    buildFASTDesign(designName)
    config[attribute] += step
  } while (@hw[designName].res < res_limit)
end
  \end{lstlisting}
\end{frame}

\begin{frame}[fragile]{Monitoring and Logging}
  \begin{itemize}
  \item Logging: useful for debugging (no run-time support)
  \end{itemize}
  \begin{lstlisting}[label=lst:label, style=lara]
aspectdef WatchVar
function.vref{is_written}:
  vref.parent.prepend('log("vref.name", vref.name)')
  vref.parent.append('log("vref.name", vref.name)')
end
  \end{lstlisting}

  \begin{itemize}
  \item Monitoring: useful for profiling
  \end{itemize}
  \begin{lstlisting}[label=lst:label, style=lara]
aspectdef LoopMonitor
function.loop{is_innermost}:
  entry:   prepend(mon_iterationIn())
  exit :   append (mon_iterationOut())
  default: prepend(mon_instanceIn())
           append(mon_instanceOut())
end
  \end{lstlisting}
\end{frame}

\begin{frame}{Demo -- \texttt{fastc}}
  \begin{figure}[!ht]
    \centering
    \def\svgwidth{\linewidth}
    \input{figs/comp-flow.pdf_tex}
  \end{figure}
  \begin{itemize}
    \setlength{\itemsep}{10pt}
  \item experimental compiler for FAST ( $\approx$ 3.5 KLOC)
  \item supports all dataflow features
  \item portability: aspects, high level pragmas
  \item optimisations: low-level pragmas, inference
  \end{itemize}
\end{frame}
