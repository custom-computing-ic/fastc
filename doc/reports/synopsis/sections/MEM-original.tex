\chapter{Original Memory Read Kernel}
\label{app:mem-read-kernel}
The following listing shows the original memory read kernel for the
Reverse Time Migration application implemented with MaxJ using
MaxCompiler 2012.1. This kernel generates the memory commands required
to fetch data from DRAM. Some typical Java constructs such as package
definitions and imports are omitted.
\begin{lstlisting}
public class Cmdread extends Kernel {
    public Cmdread(..) {
      int   Burst_inc     =1;
      HWVar iniBursts     =io.scalarInput("iniBursts",hwUInt(32));
      HWVar totalBursts   =io.scalarInput("totalBursts",hwUInt(32));
      HWVar wordsPerBurst =io.scalarInput("wordsPerBurst",hwUInt(32));
      HWVar Enable        =io.scalarInput("Enable",hwUInt(1));

      //the address counters
      Count.Params param0 = control.count.makeParams(32)
           .withEnable(Enable).withMax(wordsPerBurst).withInc(1);
      Counter counter0    = control.count.makeCounter(param0);
      HWVar  wordCount    = counter0.getCount();
      Count.Params param1 = control.count.makeParams(32)
           .withEnable(counter0.getWrap()).withMax(totalBursts).withInc(Burst_inc);
      Counter counter1    = control.count.makeCounter(param1);
      HWVar burstCount    = counter1.getCount();
      HWVar Control       = wordCount.eq(0) & Enable;
      DRAMCommandStream.makeKernelOutput("dram_read", (*@\label{app:memrk-dram}@*)
          Control,                          // control
          burstCount+iniBursts,             // address
          constant.var(hwUInt(8),Burst_inc),// size
          constant.var(hwUInt(6),  1),      // inc
          constant.var(hwUInt(4),  0),      // stream
          constant.var(false));

    }}
\end{lstlisting}